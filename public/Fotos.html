<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>GalerÃ­a de Fotos</title>
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1 class="text-center mb-4">ðŸ“· GalerÃ­a de Fotos</h1>

    <!-- Token de autenticaciÃ³n -->
    <div class="mb-4">
      <label for="tokenInput" class="form-label">Token de usuario</label>
      <input type="text" id="tokenInput" class="form-control" placeholder="Ingresa tu token">
    </div>

    <!-- Formulario para agregar foto -->
    <div class="card shadow p-4 mb-4">
      <h4>Subir nueva foto</h4>
      <form id="fotoForm">
        <div class="mb-3">
          <label for="titulo" class="form-label">TÃ­tulo</label>
          <input type="text" id="titulo" class="form-control" required>
        </div>
        <div class="mb-3">
          <label for="descripcion" class="form-label">DescripciÃ³n</label>
          <input type="text" id="descripcion" class="form-control" required>
        </div>
        <div class="mb-3">
          <label for="url" class="form-label">URL de la imagen</label>
          <input type="text" id="url" class="form-control" placeholder="https://..." required>
        </div>
        <button type="submit" class="btn btn-primary">Agregar Foto</button>
      </form>
    </div>

    <!-- GalerÃ­a -->
    <h3 class="mb-3">Fotos Subidas</h3>
    <div id="gallery" class="row g-4"></div>
  </div>

  <script>
    const API_URL = "http://localhost:3000/api/fotos"; // Ajusta segÃºn tu backend

    const form = document.getElementById("fotoForm");
    const gallery = document.getElementById("gallery");
    const tokenInput = document.getElementById("tokenInput");

    // FunciÃ³n para obtener headers con token
    function getAuthHeaders() {
      const token = tokenInput.value.trim();
      return token ? { "Content-Type": "application/json", "Authorization": `Bearer ${token}` } : { "Content-Type": "application/json" };
    }

    // ðŸ“Œ Cargar fotos (pÃºblico)
    async function cargarFotos() {
      gallery.innerHTML = "";
      const res = await fetch(API_URL);
      const fotos = await res.json();

      fotos.forEach(foto => {
        const col = document.createElement("div");
        col.className = "col-md-4";

        col.innerHTML = `
          <div class="card h-100 shadow-sm">
            <img src="${foto.url}" class="card-img-top" alt="${foto.titulo}">
            <div class="card-body">
              <h5 class="card-title">${foto.titulo}</h5>
              <p class="card-text">${foto.descripcion}</p>
              <p class="text-muted"><small>Subido por: ${foto.creador ? foto.creador.nombre : "Desconocido"}</small></p>
              <button class="btn btn-warning btn-sm me-2" onclick="editarFoto('${foto._id}')">Editar</button>
              <button class="btn btn-danger btn-sm" onclick="eliminarFoto('${foto._id}')">Eliminar</button>
            </div>
          </div>
        `;
        gallery.appendChild(col);
      });
    }

    // ðŸ“Œ Crear foto (requiere token)
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const nuevaFoto = {
        titulo: document.getElementById("titulo").value,
        descripcion: document.getElementById("descripcion").value,
        url: document.getElementById("url").value
      };

      const headers = getAuthHeaders();
      if (!headers.Authorization) {
        alert("Debes ingresar un token para crear fotos.");
        return;
      }

      await fetch(API_URL, {
        method: "POST",
        headers,
        body: JSON.stringify(nuevaFoto)
      });

      form.reset();
      cargarFotos();
    });

    // ðŸ“Œ Eliminar foto (requiere token)
    async function eliminarFoto(id) {
      const headers = getAuthHeaders();
      if (!headers.Authorization) {
        alert("Debes ingresar un token para eliminar fotos.");
        return;
      }

      if (!confirm("Â¿Seguro que quieres eliminar esta foto?")) return;
      await fetch(`${API_URL}/${id}`, { method: "DELETE", headers });
      cargarFotos();
    }

    // ðŸ“Œ Editar foto (requiere token)
    async function editarFoto(id) {
      const headers = getAuthHeaders();
      if (!headers.Authorization) {
        alert("Debes ingresar un token para editar fotos.");
        return;
      }

      const nuevoTitulo = prompt("Nuevo tÃ­tulo:");
      const nuevaDescripcion = prompt("Nueva descripciÃ³n:");
      const nuevaUrl = prompt("Nueva URL de imagen:");

      if (!nuevoTitulo || !nuevaDescripcion || !nuevaUrl) return;

      await fetch(`${API_URL}/${id}`, {
        method: "PUT",
        headers,
        body: JSON.stringify({
          titulo: nuevoTitulo,
          descripcion: nuevaDescripcion,
          url: nuevaUrl
        })
      });

      cargarFotos();
    }

    // Inicial
    cargarFotos();
  </script>
</body>
</html>

